import{L,F as k,B as j,a as N,C as U,S as I,P as G,b as F,c as H,i as D,d as Y,e as O,G as X,f as Z,g as W,h as q,V as T}from"./ProgressBar-BjBYCVti.js";import{_ as $,d as b,e as J,f as K,c as Q,a as V,g as E,o as ee}from"./index-BHF0N60e.js";const v=new U;class te extends L{constructor(l){super(l),this.propertyNameMapping={},this.customPropertyMapping={}}load(l,u,R,z){const h=this,d=new k(this.manager);d.setPath(this.path),d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setWithCredentials(this.withCredentials),d.load(l,function(w){try{u(h.parse(w))}catch(f){z?z(f):console.error(f),h.manager.itemError(l)}},R,z)}setPropertyNameMapping(l){this.propertyNameMapping=l}setCustomPropertyNameMapping(l){this.customPropertyMapping=l}parse(l){function u(e,n=0){const r=/^ply([\s\S]*)end_header(\r\n|\r|\n)/;let t="";const s=r.exec(e);s!==null&&(t=s[1]);const o={comments:[],elements:[],headerLength:n,objInfo:""},i=t.split(/\r\n|\r|\n/);let a;function C(m,x){const c={type:m[0]};return c.type==="list"?(c.name=m[3],c.countType=m[1],c.itemType=m[2]):c.name=m[1],c.name in x&&(c.name=x[c.name]),c}for(let m=0;m<i.length;m++){let x=i[m];if(x=x.trim(),x==="")continue;const c=x.split(/\s+/),S=c.shift();switch(x=c.join(" "),S){case"format":o.format=c[0],o.version=c[1];break;case"comment":o.comments.push(x);break;case"element":a!==void 0&&o.elements.push(a),a={},a.name=c[0],a.count=parseInt(c[1]),a.properties=[];break;case"property":a.properties.push(C(c,P.propertyNameMapping));break;case"obj_info":o.objInfo=x;break;default:console.log("unhandled",S,c)}}return a!==void 0&&o.elements.push(a),o}function R(e,n){switch(n){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function z(e,n){const r={};for(let t=0;t<e.length;t++){if(n.empty())return null;if(e[t].type==="list"){const s=[],o=R(n.next(),e[t].countType);for(let i=0;i<o;i++){if(n.empty())return null;s.push(R(n.next(),e[t].itemType))}r[e[t].name]=s}else r[e[t].name]=R(n.next(),e[t].type)}return r}function h(){const e={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[],faceVertexColors:[]};for(const n of Object.keys(P.customPropertyMapping))e[n]=[];return e}function d(e){const n=e.map(t=>t.name);function r(t){for(let s=0,o=t.length;s<o;s++){const i=t[s];if(n.includes(i))return i}return null}return{attrX:r(["x","px","posx"])||"x",attrY:r(["y","py","posy"])||"y",attrZ:r(["z","pz","posz"])||"z",attrNX:r(["nx","normalx"]),attrNY:r(["ny","normaly"]),attrNZ:r(["nz","normalz"]),attrS:r(["s","u","texture_u","tx"]),attrT:r(["t","v","texture_v","ty"]),attrR:r(["red","diffuse_red","r","diffuse_r"]),attrG:r(["green","diffuse_green","g","diffuse_g"]),attrB:r(["blue","diffuse_blue","b","diffuse_b"])}}function w(e,n){const r=h(),t=/end_header\s+(\S[\s\S]*\S|\S)\s*$/;let s,o;(o=t.exec(e))!==null?s=o[1].split(/\s+/):s=[];const i=new re(s);e:for(let a=0;a<n.elements.length;a++){const C=n.elements[a],m=d(C.properties);for(let x=0;x<C.count;x++){const c=z(C.properties,i);if(!c)break e;p(r,C.name,c,m)}}return f(r)}function f(e){let n=new j;e.indices.length>0&&n.setIndex(e.indices),n.setAttribute("position",new N(e.vertices,3)),e.normals.length>0&&n.setAttribute("normal",new N(e.normals,3)),e.uvs.length>0&&n.setAttribute("uv",new N(e.uvs,2)),e.colors.length>0&&n.setAttribute("color",new N(e.colors,3)),(e.faceVertexUvs.length>0||e.faceVertexColors.length>0)&&(n=n.toNonIndexed(),e.faceVertexUvs.length>0&&n.setAttribute("uv",new N(e.faceVertexUvs,2)),e.faceVertexColors.length>0&&n.setAttribute("color",new N(e.faceVertexColors,3)));for(const r of Object.keys(P.customPropertyMapping))e[r].length>0&&n.setAttribute(r,new N(e[r],P.customPropertyMapping[r].length));return n.computeBoundingSphere(),n}function p(e,n,r,t){if(n==="vertex"){e.vertices.push(r[t.attrX],r[t.attrY],r[t.attrZ]),t.attrNX!==null&&t.attrNY!==null&&t.attrNZ!==null&&e.normals.push(r[t.attrNX],r[t.attrNY],r[t.attrNZ]),t.attrS!==null&&t.attrT!==null&&e.uvs.push(r[t.attrS],r[t.attrT]),t.attrR!==null&&t.attrG!==null&&t.attrB!==null&&(v.setRGB(r[t.attrR]/255,r[t.attrG]/255,r[t.attrB]/255,I),e.colors.push(v.r,v.g,v.b));for(const s of Object.keys(P.customPropertyMapping))for(const o of P.customPropertyMapping[s])e[s].push(r[o])}else if(n==="face"){const s=r.vertex_indices||r.vertex_index,o=r.texcoord;s.length===3?(e.indices.push(s[0],s[1],s[2]),o&&o.length===6&&(e.faceVertexUvs.push(o[0],o[1]),e.faceVertexUvs.push(o[2],o[3]),e.faceVertexUvs.push(o[4],o[5]))):s.length===4&&(e.indices.push(s[0],s[1],s[3]),e.indices.push(s[1],s[2],s[3])),t.attrR!==null&&t.attrG!==null&&t.attrB!==null&&(v.setRGB(r[t.attrR]/255,r[t.attrG]/255,r[t.attrB]/255,I),e.faceVertexColors.push(v.r,v.g,v.b),e.faceVertexColors.push(v.r,v.g,v.b),e.faceVertexColors.push(v.r,v.g,v.b))}}function A(e,n){const r={};let t=0;for(let s=0;s<n.length;s++){const o=n[s],i=o.valueReader;if(o.type==="list"){const a=[],C=o.countReader.read(e+t);t+=o.countReader.size;for(let m=0;m<C;m++)a.push(i.read(e+t)),t+=i.size;r[o.name]=a}else r[o.name]=i.read(e+t),t+=i.size}return[r,t]}function B(e,n,r){function t(s,o,i){switch(o){case"int8":case"char":return{read:a=>s.getInt8(a),size:1};case"uint8":case"uchar":return{read:a=>s.getUint8(a),size:1};case"int16":case"short":return{read:a=>s.getInt16(a,i),size:2};case"uint16":case"ushort":return{read:a=>s.getUint16(a,i),size:2};case"int32":case"int":return{read:a=>s.getInt32(a,i),size:4};case"uint32":case"uint":return{read:a=>s.getUint32(a,i),size:4};case"float32":case"float":return{read:a=>s.getFloat32(a,i),size:4};case"float64":case"double":return{read:a=>s.getFloat64(a,i),size:8}}}for(let s=0,o=e.length;s<o;s++){const i=e[s];i.type==="list"?(i.countReader=t(n,i.countType,r),i.valueReader=t(n,i.itemType,r)):i.valueReader=t(n,i.type,r)}}function _(e,n){const r=h(),t=n.format==="binary_little_endian",s=new DataView(e,n.headerLength);let o,i=0;for(let a=0;a<n.elements.length;a++){const C=n.elements[a],m=C.properties,x=d(m);B(m,s,t);for(let c=0;c<C.count;c++){o=A(i,m),i+=o[1];const S=o[0];p(r,C.name,S,x)}}return f(r)}function y(e){let n=0,r=!0,t="";const s=[],o=new TextDecoder().decode(e.subarray(0,5)),i=/^ply\r\n/.test(o);do{const a=String.fromCharCode(e[n++]);a!==`
`&&a!=="\r"?t+=a:(t==="end_header"&&(r=!1),t!==""&&(s.push(t),t=""))}while(r&&n<e.length);return i===!0&&n++,{headerText:s.join("\r")+"\r",headerLength:n}}let g;const P=this;if(l instanceof ArrayBuffer){const e=new Uint8Array(l),{headerText:n,headerLength:r}=y(e),t=u(n,r);if(t.format==="ascii"){const s=new TextDecoder().decode(e);g=w(s,t)}else g=_(l,t)}else g=w(l,u(l));return g}}class re{constructor(l){this.arr=l,this.i=0}empty(){return this.i>=this.arr.length}next(){return this.arr[this.i++]}}function ne(M,l,u={}){const R=new te,z=[];let h=0;M.forEach((d,w)=>{R.load(d,f=>{var y,g;f.computeVertexNormals();const p=f.hasAttribute("color"),A=new G({size:.02,vertexColors:p,color:p?void 0:16777215,transparent:!0,opacity:.6}),B=new F(f,A);B.name=`model-${w}`,l.add(B),z.push(B),h++;const _=h/M.length;(y=u.onProgress)==null||y.call(u,_*100),h===M.length&&((g=u.onLoad)==null||g.call(u,z))},f=>{var p;if(f.lengthComputable){const A=f.loaded/f.total,B=(h+A)/M.length;(p=u.onProgress)==null||p.call(u,B)}},f=>{var p;console.error(`[PLY] Âä†ËΩΩÂ§±Ë¥•: ${d}`,f),(p=u.onError)==null||p.call(u,f,d)})})}const se={class:"page-container"},oe={__name:"RocketModel",setup(M){const l=b(null),u=b(0),R=b(!0),z=["/model-viewer-3d/rocket/rocket.ply"];let h,d,w,f,p;J(()=>{h=H(),d=D(l.value),w=Y(l.value),p=O(d,w.domElement),p.minPolarAngle=0,p.maxPolarAngle=Math.PI;const _=new X;ne(z,h,{onProgress:g=>u.value=g,onLoad:g=>{g.forEach((P,e)=>{R.value=!1,console.log("Âä†ËΩΩÊàêÂäü:",P),_.add(P),h.add(_)}),B(d,p,_,.5)},onError:(g,P)=>{console.error("Âä†ËΩΩÂ§±Ë¥•Ôºö",P,g)}});const y=()=>{f=requestAnimationFrame(y),w.render(h,d),p==null||p.update()};y(),window.addEventListener("resize",A)}),K(()=>{Z({renderer:w,scene:h,controls:p,animationId:f,resizeHandler:A})});function A(){!d||!w||(d.aspect=window.innerWidth/window.innerHeight,d.updateProjectionMatrix(),w.setSize(window.innerWidth,window.innerHeight))}function B(_,y,g,P=1.5){const e=new q().setFromObject(g),n=e.getSize(new T),r=e.getCenter(new T),t=Math.max(n.x,n.y,n.z);_.position.copy(r.clone().add(new T(10,5,t*P))),_.lookAt(r),y&&(y.target.copy(r),y.update())}return(_,y)=>(ee(),Q("div",se,[y[0]||(y[0]=V("h2",{class:"model-title"},"üöÄ ÁÅ´ÁÆ≠Ê®°ÂûãÂ±ïÁ§∫È°µÈù¢",-1)),E(W,{progress:u.value},null,8,["progress"]),V("div",{ref_key:"canvasContainer",ref:l,class:"canvas-container"},null,512)]))}},ce=$(oe,[["__scopeId","data-v-05dad373"]]);export{ce as default};
