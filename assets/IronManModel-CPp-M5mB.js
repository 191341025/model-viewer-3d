import{L as N,j as Q,F as J,k as X,R as Y,l as P,C as F,S as k,M as Z,m as B,D as $,T as ee,G as K,B as U,a as _,n as z,o as T,P as C,p as D,b as I,q as R,V as L,c as te,i as se,d as ne,e as ie,f as oe,g as re,h as ae}from"./ProgressBar-BqgO7296.js";import{_ as le,d as A,e as ce,f as he,c as de,a as E,g as pe,o as ue}from"./index-BR7KLgue.js";class fe extends N{constructor(t){super(t)}load(t,s,i,e){const n=this,c=this.path===""?Q.extractUrlBase(t):this.path,a=new J(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(o){try{s(n.parse(o,c))}catch(r){e?e(r):console.error(r),n.manager.itemError(t)}},i,e)}setMaterialOptions(t){return this.materialOptions=t,this}parse(t,s){const i=t.split(`
`);let e={};const n=/\s+/,c={};for(let o=0;o<i.length;o++){let r=i[o];if(r=r.trim(),r.length===0||r.charAt(0)==="#")continue;const h=r.indexOf(" ");let l=h>=0?r.substring(0,h):r;l=l.toLowerCase();let p=h>=0?r.substring(h+1):"";if(p=p.trim(),l==="newmtl")e={name:p},c[p]=e;else if(l==="ka"||l==="kd"||l==="ks"||l==="ke"){const f=p.split(n,3);e[l]=[parseFloat(f[0]),parseFloat(f[1]),parseFloat(f[2])]}else e[l]=p}const a=new me(this.resourcePath||s,this.materialOptions);return a.setCrossOrigin(this.crossOrigin),a.setManager(this.manager),a.setMaterials(c),a}}class me{constructor(t="",s={}){this.baseUrl=t,this.options=s,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:X,this.wrap=this.options.wrap!==void 0?this.options.wrap:Y}setCrossOrigin(t){return this.crossOrigin=t,this}setManager(t){this.manager=t}setMaterials(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(t){if(!this.options)return t;const s={};for(const i in t){const e=t[i],n={};s[i]=n;for(const c in e){let a=!0,o=e[c];const r=c.toLowerCase();switch(r){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(o=[o[0]/255,o[1]/255,o[2]/255]),this.options&&this.options.ignoreZeroRGBs&&o[0]===0&&o[1]===0&&o[2]===0&&(a=!1);break}a&&(n[r]=o)}}return s}preload(){for(const t in this.materialsInfo)this.create(t)}getIndex(t){return this.nameLookup[t]}getAsArray(){let t=0;for(const s in this.materialsInfo)this.materialsArray[t]=this.create(s),this.nameLookup[s]=t,t++;return this.materialsArray}create(t){return this.materials[t]===void 0&&this.createMaterial_(t),this.materials[t]}createMaterial_(t){const s=this,i=this.materialsInfo[t],e={name:t,side:this.side};function n(a,o){return typeof o!="string"||o===""?"":/^https?:\/\//i.test(o)?o:a+o}function c(a,o){if(e[a])return;const r=s.getTextureParams(o,e),h=s.loadTexture(n(s.baseUrl,r.url));h.repeat.copy(r.scale),h.offset.copy(r.offset),h.wrapS=s.wrap,h.wrapT=s.wrap,(a==="map"||a==="emissiveMap")&&(h.colorSpace=k),e[a]=h}for(const a in i){const o=i[a];let r;if(o!=="")switch(a.toLowerCase()){case"kd":e.color=P.toWorkingColorSpace(new F().fromArray(o),k);break;case"ks":e.specular=P.toWorkingColorSpace(new F().fromArray(o),k);break;case"ke":e.emissive=P.toWorkingColorSpace(new F().fromArray(o),k);break;case"map_kd":c("map",o);break;case"map_ks":c("specularMap",o);break;case"map_ke":c("emissiveMap",o);break;case"norm":c("normalMap",o);break;case"map_bump":case"bump":c("bumpMap",o);break;case"disp":c("displacementMap",o);break;case"map_d":c("alphaMap",o),e.transparent=!0;break;case"ns":e.shininess=parseFloat(o);break;case"d":r=parseFloat(o),r<1&&(e.opacity=r,e.transparent=!0);break;case"tr":r=parseFloat(o),this.options&&this.options.invertTrProperty&&(r=1-r),r>0&&(e.opacity=1-r,e.transparent=!0);break}}return this.materials[t]=new Z(e),this.materials[t]}getTextureParams(t,s){const i={scale:new B(1,1),offset:new B(0,0)},e=t.split(/\s+/);let n;return n=e.indexOf("-bm"),n>=0&&(s.bumpScale=parseFloat(e[n+1]),e.splice(n,2)),n=e.indexOf("-mm"),n>=0&&(s.displacementBias=parseFloat(e[n+1]),s.displacementScale=parseFloat(e[n+2]),e.splice(n,3)),n=e.indexOf("-s"),n>=0&&(i.scale.set(parseFloat(e[n+1]),parseFloat(e[n+2])),e.splice(n,4)),n=e.indexOf("-o"),n>=0&&(i.offset.set(parseFloat(e[n+1]),parseFloat(e[n+2])),e.splice(n,4)),i.url=e.join(" ").trim(),i}loadTexture(t,s,i,e,n){const c=this.manager!==void 0?this.manager:$;let a=c.getHandler(t);a===null&&(a=new ee(c)),a.setCrossOrigin&&a.setCrossOrigin(this.crossOrigin);const o=a.load(t,i,e,n);return s!==void 0&&(o.mapping=s),o}}const ge=/^[og]\s*(.+)?/,be=/^mtllib /,ve=/^usemtl /,we=/^usemap /,G=/\s+/,H=new L,O=new L,W=new L,q=new L,w=new L,V=new F;function xe(){const y={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(t,s){if(this.object&&this.object.fromDeclaration===!1){this.object.name=t,this.object.fromDeclaration=s!==!1;return}const i=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:s!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,n){const c=this._finalize(!1);c&&(c.inherited||c.groupCount<=0)&&this.materials.splice(c.index,1);const a={index:this.materials.length,name:e||"",mtllib:Array.isArray(n)&&n.length>0?n[n.length-1]:"",smooth:c!==void 0?c.smooth:this.smooth,groupStart:c!==void 0?c.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(o){const r={index:typeof o=="number"?o:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return r.clone=this.clone.bind(r),r}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){const n=this.currentMaterial();if(n&&n.groupEnd===-1&&(n.groupEnd=this.geometry.vertices.length/3,n.groupCount=n.groupEnd-n.groupStart,n.inherited=!1),e&&this.materials.length>1)for(let c=this.materials.length-1;c>=0;c--)this.materials[c].groupCount<=0&&this.materials.splice(c,1);return e&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),n}},i&&i.name&&typeof i.clone=="function"){const e=i.clone(0);e.inherited=!0,this.object.materials.push(e)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(t,s){const i=parseInt(t,10);return(i>=0?i-1:i+s/3)*3},parseNormalIndex:function(t,s){const i=parseInt(t,10);return(i>=0?i-1:i+s/3)*3},parseUVIndex:function(t,s){const i=parseInt(t,10);return(i>=0?i-1:i+s/2)*2},addVertex:function(t,s,i){const e=this.vertices,n=this.object.geometry.vertices;n.push(e[t+0],e[t+1],e[t+2]),n.push(e[s+0],e[s+1],e[s+2]),n.push(e[i+0],e[i+1],e[i+2])},addVertexPoint:function(t){const s=this.vertices;this.object.geometry.vertices.push(s[t+0],s[t+1],s[t+2])},addVertexLine:function(t){const s=this.vertices;this.object.geometry.vertices.push(s[t+0],s[t+1],s[t+2])},addNormal:function(t,s,i){const e=this.normals,n=this.object.geometry.normals;n.push(e[t+0],e[t+1],e[t+2]),n.push(e[s+0],e[s+1],e[s+2]),n.push(e[i+0],e[i+1],e[i+2])},addFaceNormal:function(t,s,i){const e=this.vertices,n=this.object.geometry.normals;H.fromArray(e,t),O.fromArray(e,s),W.fromArray(e,i),w.subVectors(W,O),q.subVectors(H,O),w.cross(q),w.normalize(),n.push(w.x,w.y,w.z),n.push(w.x,w.y,w.z),n.push(w.x,w.y,w.z)},addColor:function(t,s,i){const e=this.colors,n=this.object.geometry.colors;e[t]!==void 0&&n.push(e[t+0],e[t+1],e[t+2]),e[s]!==void 0&&n.push(e[s+0],e[s+1],e[s+2]),e[i]!==void 0&&n.push(e[i+0],e[i+1],e[i+2])},addUV:function(t,s,i){const e=this.uvs,n=this.object.geometry.uvs;n.push(e[t+0],e[t+1]),n.push(e[s+0],e[s+1]),n.push(e[i+0],e[i+1])},addDefaultUV:function(){const t=this.object.geometry.uvs;t.push(0,0),t.push(0,0),t.push(0,0)},addUVLine:function(t){const s=this.uvs;this.object.geometry.uvs.push(s[t+0],s[t+1])},addFace:function(t,s,i,e,n,c,a,o,r){const h=this.vertices.length;let l=this.parseVertexIndex(t,h),p=this.parseVertexIndex(s,h),f=this.parseVertexIndex(i,h);if(this.addVertex(l,p,f),this.addColor(l,p,f),a!==void 0&&a!==""){const d=this.normals.length;l=this.parseNormalIndex(a,d),p=this.parseNormalIndex(o,d),f=this.parseNormalIndex(r,d),this.addNormal(l,p,f)}else this.addFaceNormal(l,p,f);if(e!==void 0&&e!==""){const d=this.uvs.length;l=this.parseUVIndex(e,d),p=this.parseUVIndex(n,d),f=this.parseUVIndex(c,d),this.addUV(l,p,f),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(t){this.object.geometry.type="Points";const s=this.vertices.length;for(let i=0,e=t.length;i<e;i++){const n=this.parseVertexIndex(t[i],s);this.addVertexPoint(n),this.addColor(n)}},addLineGeometry:function(t,s){this.object.geometry.type="Line";const i=this.vertices.length,e=this.uvs.length;for(let n=0,c=t.length;n<c;n++)this.addVertexLine(this.parseVertexIndex(t[n],i));for(let n=0,c=s.length;n<c;n++)this.addUVLine(this.parseUVIndex(s[n],e))}};return y.startObject("",!1),y}class ye extends N{constructor(t){super(t),this.materials=null}load(t,s,i,e){const n=this,c=new J(this.manager);c.setPath(this.path),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(t,function(a){try{s(n.parse(a))}catch(o){e?e(o):console.error(o),n.manager.itemError(t)}},i,e)}setMaterials(t){return this.materials=t,this}parse(t){const s=new xe;t.indexOf(`\r
`)!==-1&&(t=t.replace(/\r\n/g,`
`)),t.indexOf(`\\
`)!==-1&&(t=t.replace(/\\\n/g,""));const i=t.split(`
`);let e=[];for(let a=0,o=i.length;a<o;a++){const r=i[a].trimStart();if(r.length===0)continue;const h=r.charAt(0);if(h!=="#")if(h==="v"){const l=r.split(G);switch(l[0]){case"v":s.vertices.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3])),l.length>=7?(V.setRGB(parseFloat(l[4]),parseFloat(l[5]),parseFloat(l[6]),k),s.colors.push(V.r,V.g,V.b)):s.colors.push(void 0,void 0,void 0);break;case"vn":s.normals.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));break;case"vt":s.uvs.push(parseFloat(l[1]),parseFloat(l[2]));break}}else if(h==="f"){const p=r.slice(1).trim().split(G),f=[];for(let u=0,m=p.length;u<m;u++){const b=p[u];if(b.length>0){const v=b.split("/");f.push(v)}}const d=f[0];for(let u=1,m=f.length-1;u<m;u++){const b=f[u],v=f[u+1];s.addFace(d[0],b[0],v[0],d[1],b[1],v[1],d[2],b[2],v[2])}}else if(h==="l"){const l=r.substring(1).trim().split(" ");let p=[];const f=[];if(r.indexOf("/")===-1)p=l;else for(let d=0,u=l.length;d<u;d++){const m=l[d].split("/");m[0]!==""&&p.push(m[0]),m[1]!==""&&f.push(m[1])}s.addLineGeometry(p,f)}else if(h==="p"){const p=r.slice(1).trim().split(" ");s.addPointGeometry(p)}else if((e=ge.exec(r))!==null){const l=(" "+e[0].slice(1).trim()).slice(1);s.startObject(l)}else if(ve.test(r))s.object.startMaterial(r.substring(7).trim(),s.materialLibraries);else if(be.test(r))s.materialLibraries.push(r.substring(7).trim());else if(we.test(r))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(h==="s"){if(e=r.split(" "),e.length>1){const p=e[1].trim().toLowerCase();s.object.smooth=p!=="0"&&p!=="off"}else s.object.smooth=!0;const l=s.object.currentMaterial();l&&(l.smooth=s.object.smooth)}else{if(r==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+r+'"')}}s.finalize();const n=new K;if(n.materialLibraries=[].concat(s.materialLibraries),!(s.objects.length===1&&s.objects[0].geometry.vertices.length===0)===!0)for(let a=0,o=s.objects.length;a<o;a++){const r=s.objects[a],h=r.geometry,l=r.materials,p=h.type==="Line",f=h.type==="Points";let d=!1;if(h.vertices.length===0)continue;const u=new U;u.setAttribute("position",new _(h.vertices,3)),h.normals.length>0&&u.setAttribute("normal",new _(h.normals,3)),h.colors.length>0&&(d=!0,u.setAttribute("color",new _(h.colors,3))),h.hasUVIndices===!0&&u.setAttribute("uv",new _(h.uvs,2));const m=[];for(let v=0,j=l.length;v<j;v++){const x=l[v],S=x.name+"_"+x.smooth+"_"+d;let g=s.materials[S];if(this.materials!==null){if(g=this.materials.create(x.name),p&&g&&!(g instanceof z)){const M=new z;T.prototype.copy.call(M,g),M.color.copy(g.color),g=M}else if(f&&g&&!(g instanceof C)){const M=new C({size:10,sizeAttenuation:!1});T.prototype.copy.call(M,g),M.color.copy(g.color),M.map=g.map,g=M}}g===void 0&&(p?g=new z:f?g=new C({size:1,sizeAttenuation:!1}):g=new Z,g.name=x.name,g.flatShading=!x.smooth,g.vertexColors=d,s.materials[S]=g),m.push(g)}let b;if(m.length>1){for(let v=0,j=l.length;v<j;v++){const x=l[v];u.addGroup(x.groupStart,x.groupCount,v)}p?b=new D(u,m):f?b=new I(u,m):b=new R(u,m)}else p?b=new D(u,m[0]):f?b=new I(u,m[0]):b=new R(u,m[0]);b.name=r.name,n.add(b)}else if(s.vertices.length>0){const a=new C({size:1,sizeAttenuation:!1}),o=new U;o.setAttribute("position",new _(s.vertices,3)),s.colors.length>0&&s.colors[0]!==void 0&&(o.setAttribute("color",new _(s.colors,3)),a.vertexColors=!0);const r=new I(o,a);n.add(r)}return n}}function Me(y,t,s,i={}){const{onLoad:e=()=>{},onError:n=()=>{},onProgress:c=()=>{},position:a={x:0,y:0,z:0},scale:o={x:1,y:1,z:1},rotate:r={x:0,y:0,z:0}}=i;let h=0,l=0;const p=()=>{const d=(h+l)/2;c(d*100)};new fe().load(t,d=>{h=1,p(),d.preload();const u=new ye;u.setMaterials(d),u.load(y,m=>{l=1,p(),m.position.set(a.x,a.y,a.z),m.scale.set(o.x,o.y,o.z),m.rotation.set(r.x,r.y,r.z),console.log(y),s.add(m),e(m)},m=>{m.lengthComputable&&(l=m.loaded/m.total,p())},m=>{console.error("[OBJ+MTL] 加载失败: ",m),n(m)})},d=>{d.lengthComputable&&(h=d.loaded/d.total,p())},d=>{console.error("[MTL] 加载失败: ",d),n(d)})}const Le={class:"page-container"},je={__name:"IronManModel",setup(y){const t=A(null),s=A(0),i=A(!0),e="/model-viewer-3d/IronMan/IronMan.obj",n="/model-viewer-3d/IronMan/IronMan.mtl";let c,a,o,r,h;ce(()=>{c=te(),a=se(t.value),o=ne(t.value),h=ie(a,o.domElement),h.minPolarAngle=0,h.maxPolarAngle=Math.PI;const f=new K;c.add(f),Me(e,n,f,{onProgress:u=>s.value=u,position:{x:0,y:0,z:0},scale:{x:.3,y:.3,z:.3},rotate:{x:0,y:0,z:0},onLoad:u=>{console.log("✅ 模型加载成功",u),i.value=!1,p(a,h,u)},onError:u=>{console.error("❌ 模型加载失败",u)}});const d=()=>{r=requestAnimationFrame(d),h==null||h.update(),o.render(c,a)};d(),window.addEventListener("resize",l)}),he(()=>{oe({renderer:o,scene:c,controls:h,animationId:r,resizeHandler:l})});function l(){!a||!o||(a.aspect=window.innerWidth/window.innerHeight,a.updateProjectionMatrix(),o.setSize(window.innerWidth,window.innerHeight))}function p(f,d,u,m=1.5){const b=new ae().setFromObject(u),v=b.getCenter(new L),j=b.getSize(new L),x=Math.max(j.x,j.y,j.z);f.position.copy(v.clone().add(new L(10,5,x*m))),f.lookAt(v),d&&(d.target.copy(v),d.update())}return(f,d)=>(ue(),de("div",Le,[d[0]||(d[0]=E("h2",{class:"model-title"},"🤖 钢铁侠",-1)),pe(re,{progress:s.value},null,8,["progress"]),E("div",{ref_key:"canvasContainer",ref:t,class:"canvas-container"},null,512)]))}},Ce=le(je,[["__scopeId","data-v-cdf4eb8b"]]);export{Ce as default};
